@page "/Computers/Details/{Id:int}"
@using Toems_Common.Entity
@using Toems_UI.Site.Layout
@using Toems_UI.Site.Pages.Computers.Components
@using Toems_UI.Components
@using Toems_UI.Site.Pages.Computers.Actions
@inject Toems_ApiCalls.APICall Call
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject IJSRuntime JS
@inherits BasePage
<ActionButtons>
    <Content>
        <MudMenuItem Label="Get Status" OnClick="@((e) => GetStatusAsync())"/>
    </Content>
</ActionButtons>


<MudPaper Class="pa-2 mb-8" Elevation="5"  >

    <MudTabs Outlined="true" Position="@pos" Rounded="false" Border="true" @bind-ActivePanelIndex="_selectedTabIndex"
             ApplyEffectsToContainer="true" Class="mt-2" PanelClass="pa-4" Elevation="0" AlwaysShowScrollButtons="true"  >
        <MudTabPanel Text="Attachments">
            <MudStack Class="stack-full">
                <Attachments Computer="Computer"></Attachments>
                <br/> <br/>
            </MudStack>
        </MudTabPanel>
        <MudTabPanel Text="Certificates">
            <Certificates Computer="@Computer"/>
        </MudTabPanel>
        <MudTabPanel Text="Comments">
            <MudStack Class="stack-full">
                <Comments Computer="Computer"></Comments>
            </MudStack>
        </MudTabPanel>
        <MudTabPanel Text="Custom Attributes">
            <MudStack Class="width-full">
                <CustomAttributes Computer="Computer"></CustomAttributes>
            </MudStack>
        </MudTabPanel>
        <MudTabPanel Text="Custom Inventory">
        </MudTabPanel>
        <MudTabPanel Text="Effective Policy">
        </MudTabPanel>
        <MudTabPanel Text="General">
            <MudStack>
                <General Computer="@Computer"/>
                <br/><br/>
            </MudStack>
        </MudTabPanel>
        <MudTabPanel Text="Image Logs">
        </MudTabPanel>
        <MudTabPanel Text="Image Settings">
        </MudTabPanel>
        <MudTabPanel Text="Instant Module Runner">
        </MudTabPanel>
        <MudTabPanel Text="Policy History">
        </MudTabPanel>
        <MudTabPanel Text="Software">
        </MudTabPanel>
        <MudTabPanel Text="System Info">
        </MudTabPanel>
        <MudTabPanel Text="Usages">
        </MudTabPanel>
        <MudTabPanel Text="User Login History">
        </MudTabPanel>
        <MudTabPanel Text="Windows Updates">
        </MudTabPanel>

    </MudTabs>
</MudPaper>

@code {
    [Parameter] public int Id { get; set; }
    [Parameter] public EntityComputer Computer {get; set;} = new();
    public Position pos { get; set; } = Position.Left;
    private int _selectedTabIndex = 6;
    protected override async Task OnInitializedAsync()
    {
        Computer = await Call.ComputerApi.Get(Id);
        var deviceInfo = await JS.InvokeAsync<DeviceInfo>("getDeviceInfo");
        if(deviceInfo.ScreenWidth < 768)
        {
            pos = Position.Top;
        }
        else
        {
            pos = Position.Left;
        }
    }
    
    private async Task GetStatusAsync()
    {
        var parameters = new DialogParameters<ActionStatus>
        {
            { x => x.Computer, Computer },
        };
        await DialogService.ShowAsync<ActionStatus>("New", parameters, DialogOptionsConstants.DeleteDialogOptions);
    }
    private class DeviceInfo
    {
        public int ScreenWidth { get; set; }
        public int ScreenHeight { get; set; }
        public bool IsMobile { get; set; }
        public bool IsTouchDevice { get; set; }
    }
  
}
