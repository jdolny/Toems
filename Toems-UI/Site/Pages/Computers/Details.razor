@page "/Computers/Details/{Id:int}"
@using Toems_Common.Entity
@using Toems_UI.Site.Layout
@using Toems_UI.Site.Pages.Computers.Components
@using Toems_UI.Components
@inject Toems_ApiCalls.APICall Call
@inject IDialogService DialogService
@inject ISnackbar Snackbar

<ActionButtons>
    <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined">
        <MudButton>Actions</MudButton>
        <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Style="align-self: auto;">
        
            <MudMenuItem>Reply All</MudMenuItem>
            <MudMenuItem>Forward</MudMenuItem>
            <MudMenuItem>Reply & Delete</MudMenuItem>
            <MudDivider />
            <MudMenuItem OnClick="@((e) => GetStatusAsync())">Get Status</MudMenuItem>
        </MudMenu>
    </MudButtonGroup>
</ActionButtons>

<MudPaper Class="pa-2 mb-8" Elevation="5"  >
<MudTabs Outlined="true" Position="Position.Left" Rounded="false" Border="true"  @bind-ActivePanelIndex="_selectedTabIndex"
         ApplyEffectsToContainer="true" Class="mt-2" PanelClass="pa-4" Elevation="0"  >
    <MudTabPanel Text="Attachments">
        <MudStack Class="content-container">
        <Attachments Computer="Computer"></Attachments>
        </MudStack>
    </MudTabPanel>
    <MudTabPanel Text="Certificates">
    </MudTabPanel>
    <MudTabPanel Text="Comments">
    </MudTabPanel>
    <MudTabPanel Text="Custom Attributes">
    </MudTabPanel>
    <MudTabPanel Text="Custom Inventory">
    </MudTabPanel>
    <MudTabPanel Text="Effective Policy">
    </MudTabPanel>
    <MudTabPanel Text="General">
        <MudStack Class="content-container">
                <General Computer="@Computer"/>
       </MudStack>
    </MudTabPanel>
    <MudTabPanel Text="Image Logs">
    </MudTabPanel>
    <MudTabPanel Text="Image Settings">
    </MudTabPanel>
    <MudTabPanel Text="Instant Module Runner">
    </MudTabPanel>
    <MudTabPanel Text="Policy History">
    </MudTabPanel>
    <MudTabPanel Text="Software">
    </MudTabPanel>
    <MudTabPanel Text="System Info">
    </MudTabPanel>
    <MudTabPanel Text="Usages">
    </MudTabPanel>
    <MudTabPanel Text="User Login History">
    </MudTabPanel>
    <MudTabPanel Text="Windows Updates">
    </MudTabPanel>
    
</MudTabs>
</MudPaper>
@code {
    [CascadingParameter] public MainLayout? Layout { get; set; }
    [Parameter] public int Id { get; set; }
    [Parameter] public EntityComputer Computer {get; set;} = new();
    private int _selectedTabIndex = 6;
    protected override async Task OnInitializedAsync()
    {
        Computer = await Call.ComputerApi.Get(Id);
    }
    
    private async Task GetStatusAsync()
    {
        var parameters = new DialogParameters<ActionStatus>
        {
            { x => x.Computer, Computer },
        };
        await DialogService.ShowAsync<ActionStatus>("New", parameters, DialogOptionsConstants.DeleteDialogOptions);
    }
  
}
