@using System.Globalization
@using Toems_ApiCalls
@using Toems_Common.Dto
@using Toems_Common.Entity
@using Toems_UI.Site.Layout
@layout MainLayout
@inject APICall Call
@inherits BaseComponent
@inject ISnackbar Snackbar

<ActionButtons InsertAtTop="true">
    <MainButton/>
    <Content/>
</ActionButtons>

<MudTabs Outlined="true" Position="Position.Top" Centered="true" Rounded="false" Border="true"  
         ApplyEffectsToContainer="false" Class="mt-2" PanelClass="pa-4" Elevation="0" >
<MudTabPanel Text="OS">

    <MudGrid >
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="Computer Name" Value="@(_inventory.ComputerSystem.Name ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="Domain" Value="@(_inventory.ComputerSystem.Domain ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="Workgroup" Value="@(_inventory.ComputerSystem.Workgroup ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="OS Name" Value="@(_inventory.Os.Caption ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="OS Version" Value="@(_inventory.Os.Version ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="OS Build" Value="@(_inventory.Os.BuildNumber ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="OS Release ID" Value="@(_inventory.Os.ReleaseId ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="OS Architecture" Value="@(_inventory.Os.OSArchitecture ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="OS Service Pack Major" Value="@(_inventory.Os.ServicePackMajorVersion.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="OS Service Pack Minor" Value="@(_inventory.Os.ServicePackMinorVersion.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudTextField T="string" ReadOnly="true" Label="Time Zone" Value="@(_inventory.Os.LocalTimeZone ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
        </MudItem>
        
    </MudGrid>

</MudTabPanel>
<MudTabPanel Text="Hardware">
        <MudGrid >
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Manufacturer" Value="@(_inventory.ComputerSystem.Manufacturer ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Model" Value="@(_inventory.ComputerSystem.Model ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Bios Serial Number" Value="@(_inventory.Bios.SerialNumber ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Bios Version" Value="@(_inventory.Bios.Version ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="SMBIOS Version" Value="@(_inventory.Bios.SMBIOSBIOSVersion ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Processor" Value="@(_inventory.Processor.Name ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Processor Clock Speed" Value="@(_inventory.Processor.Speed.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Processor Cores" Value="@(_inventory.Processor.Cores.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Memory (MB)" Value="@(_inventory.ComputerSystem.Memory.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
        </MudGrid>
        <br/>
        <MudDataGrid RowsPerPage="@Constants.DefaultPageSize" Dense="true" HorizontalScrollbar="true" FixedFooter="true" FixedHeader="true" Striped="true" T="EntityHardDriveInventory" Class="mb-2 full-data-grid" Elevation="2" Items="@_inventory.HardDrives" ColumnResizeMode="ResizeMode.Column">
            <ToolBarContent>
                <MudText Typo="Typo.h5" Color="Color.Primary">Hard Drives</MudText>
                <MudSpacer/>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.Model" Title="Model"/>
                <PropertyColumn Property="x => x.SerialNumber" Title="Serial"/>
                <PropertyColumn Property="x => x.FirmwareRevision" Title="Firmware"/>
                <PropertyColumn Property="x => x.SizeMb" Title="Size (MB)"/>
                <PropertyColumn Property="x => x.Status" Title="Smart Status"/>
            </Columns>
        </MudDataGrid>
        <br/>
        <MudDataGrid RowsPerPage="@Constants.DefaultPageSize" Dense="true" HorizontalScrollbar="true" FixedFooter="true" FixedHeader="true" Striped="true" T="EntityLogicalVolumeInventory" Class="mb-2 full-data-grid" Elevation="2" Items="@_inventory.LogicalVolume" ColumnResizeMode="ResizeMode.Column">
            <ToolBarContent>
                <MudText Typo="Typo.h5" Color="Color.Primary">Logical Volumes</MudText>
                <MudSpacer/>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.Drive" Title="Drive Letter"/>
                <PropertyColumn Property="x => x.SizeGB" Title="Size (GB)"/>
                <PropertyColumn Property="x => x.FreeSpacePercent" Title="Free (%)"/>
                <PropertyColumn Property="x => x.FreeSpaceGB" Title="Free (GB)"/>
            </Columns>
        </MudDataGrid>
        <br/>
        <MudDataGrid RowsPerPage="@Constants.DefaultPageSize" Dense="true" HorizontalScrollbar="true" FixedFooter="true" FixedHeader="true" Striped="true" T="EntityNicInventory" Class="mb-2 full-data-grid" Elevation="2" Items="@_inventory.Nics" ColumnResizeMode="ResizeMode.Column">
            <ToolBarContent>
                <MudText Typo="Typo.h5" Color="Color.Primary">Network Adapters</MudText>
                <MudSpacer/>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.Name" Title="Name"/>
                <PropertyColumn Property="x => x.Description" Title="Description"/>
                <PropertyColumn Property="x => x.Type" Title="Type"/>
                <PropertyColumn Property="x => x.Mac" Title="MAC"/>
                <PropertyColumn Property="x => x.Speed" Title="Speed"/>
                <PropertyColumn Property="x => x.Ips" Title="IP(s)"/>
                <PropertyColumn Property="x => x.Gateways" Title="Gateway"/>
            </Columns>
        </MudDataGrid>
        <br/>
        <MudDataGrid RowsPerPage="@Constants.DefaultPageSize" Dense="true" HorizontalScrollbar="true" FixedFooter="true" FixedHeader="true" Striped="true" T="EntityComputerGpuInventory" Class="mb-2 full-data-grid" Elevation="2" Items="@_inventory.Gpu" ColumnResizeMode="ResizeMode.Column">
            <ToolBarContent>
                <MudText Typo="Typo.h5" Color="Color.Primary">GPUs</MudText>
                <MudSpacer/>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.Name" Title="Name"/>
                <PropertyColumn Property="x => x.Memory" Title="Memory (MB)"/>
            </Columns>
        </MudDataGrid>
</MudTabPanel>
    <MudTabPanel Text="Security">
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="UAC Status" Value="@(_inventory.Os.UacStatus ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Location Services Enabled" Value="@(_inventory.Os.LocationEnabled.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Domain Firewall Enabled" Value="@(_inventory.Firewall.DomainEnabled.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Private Firewall Enabled" Value="@(_inventory.Firewall.PrivateEnabled.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Public Firewall Enabled" Value="@(_inventory.Firewall.PublicEnabled.ToString() ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Update Server" Value="@(_inventory.Os.UpdateServer ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Update Server Target Group" Value="@(string.IsNullOrEmpty(_inventory.Os.SUStargetGroup) ? "N/A" : _inventory.Os.SUStargetGroup )" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
        </MudGrid>
        <br/>
        <MudDataGrid RowsPerPage="@Constants.DefaultPageSize" Dense="true" HorizontalScrollbar="true" FixedFooter="true" FixedHeader="true" Striped="true" T="EntityAntivirusInventory" Class="mb-2 full-data-grid" Elevation="2" Items="@_inventory.AntiVirus" ColumnResizeMode="ResizeMode.Column">
            <ToolBarContent>
                <MudText Typo="Typo.h5" Color="Color.Primary">AntiVirus</MudText>
                <MudSpacer/>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.DisplayName" Title="Name"/>
                <PropertyColumn Property="x => x.Provider" Title="Provider"/>
                <PropertyColumn Property="x => x.RealtimeScanner" Title="Real Time Scanner Status"/>
                <PropertyColumn Property="x => x.DefinitionStatus" Title="Definition Status"/>
                <PropertyColumn Property="x => x.ProductState" Title="Product State"/>
            </Columns>
        </MudDataGrid>
        <br/>
        <MudDataGrid RowsPerPage="@Constants.DefaultPageSize" Dense="true" HorizontalScrollbar="true" FixedFooter="true" FixedHeader="true" Striped="true" T="EntityBitlockerInventory" Class="mb-2 full-data-grid" Elevation="2" Items="@_inventory.Bitlocker" ColumnResizeMode="ResizeMode.Column">
            <ToolBarContent>
                <MudText Typo="Typo.h5" Color="Color.Primary">Bitlocker</MudText>
                <MudSpacer/>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.DriveLetter" Title="Drive"/>
                <PropertyColumn Property="x => x.Status" Title="Status"/>
            </Columns>
        </MudDataGrid>
    </MudTabPanel>
    <MudTabPanel Text="Printers">
        <MudDataGrid RowsPerPage="@Constants.DefaultPageSize" Dense="true" HorizontalScrollbar="true" FixedFooter="true" FixedHeader="true" Striped="true" T="EntityPrinterInventory" Class="mb-2 full-data-grid" Elevation="2" Items="@_inventory.Printers" ColumnResizeMode="ResizeMode.Column">
            <ToolBarContent>
                <MudText Typo="Typo.h5" Color="Color.Primary">Printers</MudText>
                <MudSpacer/>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.Name" Title="Name"/>
                <PropertyColumn Property="x => x.SystemName" Title="System"/>
                <PropertyColumn Property="x => x.ShareName" Title="Share"/>
                <PropertyColumn Property="x => x.DriverName" Title="Driver"/>
                <PropertyColumn Property="x => x.Local" Title="Local"/>
                <PropertyColumn Property="x => x.Network" Title="Network"/>
            </Columns>
        </MudDataGrid>
    </MudTabPanel>
    <MudTabPanel Text="Location">
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Latitude" Value="@(_inventory.Os.Latitude ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Longitude" Value="@(_inventory.Os.Longitude ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField T="string" ReadOnly="true" Label="Last Location Update" Value="@(_inventory.Os.LastLocationUpdateUtc.ToString(CultureInfo.InvariantCulture) ?? "N/A")" Typo="Typo.body2" Variant="Variant.Text"></MudTextField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudLink Target="_blank" Href="@($"https://www.google.com/maps/search/?api=1&query={_inventory.Os.Latitude},{_inventory.Os.Longitude}")">View on Google Maps</MudLink>
                </MudItem>
        </MudGrid>
    </MudTabPanel>

</MudTabs>



@code {
    [Parameter] public EntityComputer Computer { get; set; } = new();
    private DtoInventoryCollection _inventory = new();
    protected override async Task OnParametersSetAsync()
    {
        if (Computer.Id == 0 || ParametersSet || !SetTitleAndBreadcrumbs($"{Computer.Name}",new ComputerBreadcrumbs(Computer.Name).SystemInformation())) return;
        _inventory = await Call.ComputerApi.GetSystemInfo(Computer.Id);
    }
}